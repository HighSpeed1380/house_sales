/*
 * Copyright (c) 2016 Mohamed Sadiq (http://sadiq.in)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version 1.0
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(p){p.fn.numeric=function(e,t){"boolean"==typeof e&&(e={decimal:e,negative:!0,decimalPlaces:-1}),void 0===(e=e||{}).negative&&(e.negative=!0);var n=!1===e.decimal?"":e.decimal||".",r=!0===e.negative,e=void 0===e.decimalPlaces?-1:e.decimalPlaces;return t="function"==typeof t?t:function(){},this.data("numeric.decimal",n).data("numeric.negative",r).data("numeric.callback",t).data("numeric.decimalPlaces",e).keypress(p.fn.numeric.keypress).keyup(p.fn.numeric.keyup).blur(p.fn.numeric.blur)},p.fn.numeric.keypress=function(e){var t=p.data(this,"numeric.decimal"),n=p.data(this,"numeric.negative"),r=p.data(this,"numeric.decimalPlaces"),i=e.charCode||e.keyCode||0;if(13==i&&"input"==this.nodeName.toLowerCase())return!0;if(13==i)return!1;if(35==i||36==i||37==i)return!1;var a=!1;if(e.ctrlKey&&97==i||e.ctrlKey&&65==i)return!0;if(e.ctrlKey&&120==i||e.ctrlKey&&88==i)return!0;if(e.ctrlKey&&99==i||e.ctrlKey&&67==i)return!0;if(e.ctrlKey&&122==i||e.ctrlKey&&90==i)return!0;if(e.ctrlKey&&118==i||e.ctrlKey&&86==i||e.shiftKey&&45==i)return!0;if(i<48||57<i){var c=p(this).val();if(0!==p.inArray("-",c.split(""))&&n&&45==i&&(0===c.length||0===parseInt(p.fn.getSelectionStart(this),10)))return!0;t&&i==t.charCodeAt(0)&&-1!=p.inArray(t,c.split(""))&&(a=!1),8!=i&&9!=i&&13!=i&&35!=i&&36!=i&&37!=i&&39!=i&&46!=i&&1633!=i&&1634!=i&&1635!=i&&1636!=i&&1637!=i&&1638!=i&&1639!=i&&1640!=i&&1641!=i&&1632!=i?a=!1:void 0!==e.charCode&&(e.keyCode==e.which&&0!==e.which?(a=!0,46==e.which&&(a=!1)):0!==e.keyCode&&0===e.charCode&&0===e.which&&(a=!0)),t&&i==t.charCodeAt(0)&&(a=-1==p.inArray(t,c.split("")))}else{a=!0;t&&0<r&&(i=p.fn.getSelectionStart(this),c=p.fn.getSelectionEnd(this),t=p.inArray(t,p(this).val().split("")),i===c&&0<=t&&t<i&&p(this).val().length>t+r&&(a=!1))}return a},p.fn.numeric.keyup=function(e){var t=p(this).val();if(t&&0<t.length){var n=p.fn.getSelectionStart(this),r=p.fn.getSelectionEnd(this),i=p.data(this,"numeric.decimal"),a=p.data(this,"numeric.negative"),c=p.data(this,"numeric.decimalPlaces");""!==i&&null!==i&&(0===(g=p.inArray(i,t.split("")))&&(this.value="0"+t,n++,r++),1==g&&"-"==t.charAt(0)&&(this.value="-0"+t.substring(1),n++,r++),t=this.value);for(var u=[0,1,2,3,4,5,6,7,8,9,"-",i],l=t.length,s=l-1;0<=s;s--){var o=t.charAt(s);0!==s&&"-"==o?t=t.substring(0,s)+t.substring(s+1):0!==s||a||"-"!=o||(t=t.substring(1));for(var f=p.fn.parseArabic(o),d=!1,h=!1,m=0;m<u.length;m++)if(o==u[m]||f==u[m]){f==u[m]&&o!=u[m]&&(h=!0),d=!0;break}h&&(t=t.substring(0,s)+f+t.substring(s+1)),d&&" "!=o||(t=t.substring(0,s)+t.substring(s+1))}var g,v=p.inArray(i,t.split(""));if(0<v)for(var y=l-1;v<y;y--)t.charAt(y)==i&&(t=t.substring(0,y)+t.substring(y+1));i&&0<c&&0<=(g=p.inArray(i,t.split("")))&&(t=t.substring(0,g+c+1),r=Math.min(t.length,r)),this.value=t,p.fn.setSelection(this,[n,r])}},p.fn.numeric.blur=function(){var e=p.data(this,"numeric.decimal"),t=p.data(this,"numeric.callback"),n=p.data(this,"numeric.negative"),r=this.value;""!==r&&(new RegExp("^"+(n?"-?":"")+"\\d+$|^"+(n?"-?":"")+"\\d*"+e+"\\d+$").exec(r)||t.apply(this))},p.fn.removeNumeric=function(){return this.data("numeric.decimal",null).data("numeric.negative",null).data("numeric.callback",null).data("numeric.decimalPlaces",null).unbind("keypress",p.fn.numeric.keypress).unbind("keyup",p.fn.numeric.keyup).unbind("blur",p.fn.numeric.blur)},p.fn.parseArabic=function(e){return Number(e.replace(/[٠١٢٣٤٥٦٧٨٩]/g,function(e){return e.charCodeAt(0)-1632}).replace(/[۰۱۲۳۴۵۶۷۸۹]/g,function(e){return e.charCodeAt(0)-1776}))},p.fn.getSelectionStart=function(e){if("number"!==e.type){if(e.createTextRange&&document.selection){var t=document.selection.createRange().duplicate();return t.moveEnd("character",e.value.length),""==t.text?e.value.length:Math.max(0,e.value.lastIndexOf(t.text))}try{return e.selectionStart}catch(e){return 0}}},p.fn.getSelectionEnd=function(e){if("number"!==e.type){if(e.createTextRange&&document.selection){var t=document.selection.createRange().duplicate();return t.moveStart("character",-e.value.length),t.text.length}return e.selectionEnd}},p.fn.setSelection=function(e,t){if("number"==typeof t&&(t=[t,t]),t&&t.constructor==Array&&2==t.length)if("number"===e.type)e.focus();else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveStart("character",t[0]),n.moveEnd("character",t[1]-t[0]),n.select()}else{e.focus();try{e.setSelectionRange&&e.setSelectionRange(t[0],t[1])}catch(e){}}}});
